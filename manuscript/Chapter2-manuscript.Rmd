---
title: "Hunting experience and prey variability jointly shape individual foraging specialisation in a predator-prey videogame"
output: 
  word_document:
    reference_docx: Chapter2-styles.docx
    fig_caption: yes
    pandoc_args: ["-Fpandoc-crossref"] # to have eq. numbers
bibliography: references.bib
csl: e-letters.csl
---

```{r setup, include = FALSE}

knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

library(data.table)
library(brms)
library(flextable)
library(officer)

```

```{r}

path <- file.path(here::here(), "data")
dat <- fread(file.path(path, "FraserFrancoetalXXXX-data.csv"),
             select = c("pred_timestamp", "match_encode_id", "pred_game_mode",
                        "realm_id", "environment_id", "predator_avatar_id",
                        "predator_id", "pred_game_duration",
                        "total_xp_killer", "cumul_xp_killer", "hunting_success",
                        "pred_speed", "prey_avg_speed"))

dat <- unique(dat)
dat <- dat[pred_game_mode == "Online"]
dat[, c(2:7) := lapply(.SD, function (x) as.factor(x)), .SDcols = c(2:7)]

# To have a date column
dat[, date := as.POSIXct(sub(" .*", "", pred_timestamp))]

```

\newpage
# ABSTRACT {.unnumbered}

Keywords: foraging behavior, individual specialization, experience, learning, prey predictability, online videogames



\newpage
# INTRODUCTION {.unnumbered}

Individual variation in predator foraging behavior is increasingly recognized as a major driver of trophic interactions and community dynamics [@Griffen.etal2012;@Michalko.Pekar2016;@Moran.etal2017;@Michalko.etal2021]. Indeed, predator populations are often composed of assemblages of individuals specializing in different foraging strategies or resources irrespective of sexual, morphological, or age-related differences [@Estes.etal2003;@Tinker.etal2008;@kernaleguenDeterminantsIndividualForaging2015;@Phillips.etal2017]. A growing body of evidence suggests that ecological interactions, such as predator-prey interactions, can be major drivers of such individual foraging specialization [@Araujo.etal2011;@toscanoPersonalityForagingBehavior2016]. When they hunt, predators often use techniques that are fine-tuned to the type of prey that they encounter [@Davoren.etal2003;@Estes.etal2003;@Woo.etal2008;@Courbin.etal2018], and their capacity to use them effectively is contingent on periods of extensive practice (i.e. experience). While the development of hunting experience may be essential to maintain foraging success, we have have limited evidence for its role in predator foraging specialization, and the ecological/fitness consequences of such among individual behavioral differences for predator-prey interactions [@Dukas2019].

The integration of individual behavioral variation in the study of predator-prey interactions has gained traction in recent years, with empirical studies revealing important consequences for habitat use, functional responses, prey choice, and foraging rate [@Kobler.etal2009;@toscanoTraitmediatedFunctionalResponses2014;@Patrick.Weimerskirch2014;@Matsumura.Miyatake2022a]. However, an important and recurring challenge impeding research on predator-prey behavioral interactions, at the individual level, is the need of collecting data simultaneously on both the predator and prey. We have recently demonstrated with behavioral data from an online predator-prey videogame that virtual systems can help in overcoming this challenge, and uncover details on the mechanisms shaping these interactions [@FraserFranco.etal2022]. For instance, we tested the classical locomotor crossover hypothesis championed by @Huey.Pianka1981, and found support of its predictions only for active hunters, which concords with a recent experiment involving assassin bugs [@Matsumura.Miyatake2022a]. Thus, virtual systems may be useful in identifying general ecological patterns, which may in turn help in advancing the current gaps in predator-prey research. Other studies on virtual predator-prey systems show that predation regimes can drive individual variation in risk perception [@Beauchamp2020], that familiarity between prey has a positive indirect effect on survival [@Cere.etal2021], and that prey face contrasting natural and social selection regimes (Santostefano et al. in prep). Because virtual predator-prey systems generate large volumes of data on interacting players throughout their lifetime in the game, they offer the opportunity to tackle fundamental questions about the role of experience and prey behavior on individual predator foraging specialization along with its potential fitness consequences.

The development of foraging strategies is crucial for young predators to reach adulthood and survive [@Phillips.etal2017;@Heithaus.etal2018]. Theory predicts that foraging specialization may emerge via learning, limitations in memorizing multiple complex hunting skills, and expertise [@Tinker.etal2009;@Dukas2019]. @Dukas2019 defines expertise as the characteristics, skills, and knowledge allowing individuals with extensive experience to outperform novices on complex tasks. This body of work suggests that the development of expertise is an optimizing process that promotes foraging specialization. Empirical studies on human and non-human hunters show that experience optimizes the efficiency (e.g. search and handling times, return rates) of their foraging tactics potentially via associative images or reliance on prey and environmental cues [@Edwards.Jackson1994;@Morse2000;@macdonaldCrossculturalComparisonLearning2007;@Reid.etal2010;@Wilson-Rankin2015]. Such optimization may thus reinforce the use of the same tactic (i.e. specialization) if its success is constant each time a prey is encountered. It may also be costly to attempt different hunting tactics by trial and error when prey are scarce or highly unpredictable [@Dukas1998;@Estes.etal2003;@Mery.Burns2010]. An alternative mechanism is that the costs/risks faced by hunters when switching foraging tactics may be offset by gaining experience and information on their prey, leading to increased individual foraging flexibility [@Ishii.Shimada2010;@Mery.Burns2010;@Snell-Rood2013]. To develop proper responses to fluctuating resources, individuals would need to sample their environment broadly during an extensive period of time, followed by higher performance at later stages of development [reviewed in @Snell-Rood2013].

There is currently a lack of consensus on the fitness advantages of specialized vs flexible foraging. Importantly, we have limited information on the ecological contexts - except for competition - that favor one strategy over the other. This is reflected in the literature showing contrasting results in the links between specialization and fitness. For instance, some studies report increasing benefits of specializing [@Patrick.Weimerskirch2014a;@vandenBosch.etal2019], some report that flexible foraging has greater benefits [@Paull.etal2012;@Manlick.etal2021], and others find equal benefits depending on timescales [@Woo.etal2008;@Potier.etal2015]. While quantifying the fitness consequences of specialization is a daunting task, in predator-prey systems, some clues indicate that fluctuations in the predictability of prey encounters throughout a predator's lifetime may be a key factor [@Weimerskirch2007;@Woo.etal2008;@Chang.etal2017;@Phillips.etal2017;@Courbin.etal2018]. The resource-predictability hypothesis advances that when resources are predictable, individual specialists should have higher delivery rates by reducing the energy and time required to search for and handle prey. In contrast, individual generalists should be advantaged when resources fluctuate, as fine adjustments to resources are key for a predator's success and survival [@Karkarey.etal2017;@Holm.etal2019;@Santoro.etal2019]. This hypothesis has however not been tested in systems where behavioral interactions are simultaneously monitored between predator and prey individuals.

In this study, we analyze individual behavioral data from players in *Dead by Daylight* (*DBD*) to test how hunting expertise and prey behavior shape predator foraging specialization. *DBD* is an online videogame simulating a predator-prey interaction, where one predator player hunts four prey players in different virtual environments. The data grants a high degree of precision on the behavioral interaction as both the predator and the four prey are measured simultaneously in each trial. First, we investigate how predators developed their individual hunting expertise. We hypothesize that predators should differ in the development of their expertise because they encounter varying levels of difficulty with the prey that they hunt. Second, we test the hypothesis that individual variation in foraging behavior will change with experience. If experience reduces the costs of switching between hunting tactics, we predict that individual predators should become more flexible with time. Alternatively, if experience enables the refinement of the hunting tactics, then individuals may instead specialize. Third, we evaluate how predator foraging specialization interacts with variation in prey behavior. Whether predators specialize or not with experience may depend on the behavior of their prey, for instance, as it may be harder to specialize when encounters are less predictable. Lastly, if individuals differ in their degree of foraging specialization, then we expect specialist hunters to fare better when prey variability is lower, while flexible hunters should fare better when prey variability is higher.



\newpage
# MATERIALS AND METHODS {.unnumbered}


## Study system

*DBD* is a survival horror asymmetric multiplayer online game developed by Behavior Interactive Inc. In this game, players get to chose if they wish to play has a predator or a prey. The objective of the predator player is to hunt and capture the four prey players across a virtual environment. The objective of the four prey players is to forage for resources while avoiding the predator. The resources are in the form of power generators that once activated, will enable the prey to escape through one of two exit doors. The composition of the predator and prey group for a match is determined by a skill-based matchmaking algorithm. A match ends when the predator kills all the prey available (i.e. that haven't escaped), or when the last remaining prey escapes the virtual environment. Each player, predator or prey, can chose an avatar with abilities that encourage specific play styles (e.g. bolder vs cautious prey, or ambush vs roaming predator). During our study period, the game offered 23 playable predator avatars. The virtual environment where matches take place is composed of fixed and procedurally generated habitat components, such as vegetation, mazes, and buildings. Some of these environments are larger than others, with varying structural complexity. However, we have previously shown that predators display only minimal changes in behavior and hunting success across the environments, probably due to a game feature enabling predators to have visual cues on the generators [@FraserFranco.etal2022]. There were 35 virtual game environments available for play during our study period.

Individual predators in *DBD* display variation in the hunting strategies that they use. Some specialize at hunting at high speeds and covering space in the environment, while others prefer to stalk and ambush their prey [@FraserFranco.etal2022]. They also display flexibility in the use of these tactics by switching between them across matches. The expression of these tactics and their success is also shaped by the behavior of the prey group. The prey need to forage for resources while maintaining a high level of attention on the predator cues to avoid being detected and chased. Some prey contribute to the group's success by healing or helping others escape the predator, while other self-centered individuals play alone and attempt to escape by themselves [@Cere.etal2021]. Predators must be wary of how the prey behave to chose the right way to capture them. Thus, *DBD* simulates a highly dynamic system where both predators and prey must constantly adapt to each other to be successful.


## Data collection

We were provided raw data by the videogame company that spanned a period of 6 months of gameplay recorded for every player. The first recorded match was played on `r toString(format(min(dat$date)))`, and the last one on `r toString(format(max(dat$date)))`. We applied cleaning and filtering procedures on the raw data to produce a synthetic dataset for our analyses. We only analyzed matches where players did not know each other (i.e. "Online" mode). We filtered any matches where players were inactive, such as when speed values were equal to, or very close to, zero. Moreover, we used our knowledge of the game to remove any matches where players were potentially hacking, or not playing the game has it is supposed to be played. These matches were not considered as player experience. We then proceeded to partition the player population by total experience, and randomly sampled players to have a uniform representation of total gameplay experience. To optimize the representation of gameplay experience at advanced levels, we set the maximum amount of matches at 500 for these players. For instance, there could be a large difference in gameplay between 300-500 and 500-1000 matches. Players that played above 500 matches represented only ~2% of the population.

Our population consists of `r toString(format(length(unique(dat$predator_id))))` predator players with a total record of `r toString(format(length(unique(dat$match_encode_id))))` matches. The predator players' experience varied between `r toString(format(min(dat$total_xp_killer)))` and `r toString(format(max(dat$total_xp_killer)))` matches played. These matches lasted between `r toString(format(round(min(dat$pred_game_duration / 60))), digits = 2)` and `r toString(format(round(max(dat$pred_game_duration / 60))), digits = 2)` minutes (mean = `r toString(format(round(mean(dat$pred_game_duration / 60))), digits = 2)`). The following information is collected and reported for every match : the player's anonymous ID, its avatar, the game environment, the predator player's experience along with its speed, and the average speed of the group of prey it encountered.


## Variables

We analyzed the predator's average speed and the average speed of the prey encountered by the predator. The predator's average speed is measured as the average distance per second traveled during a match (m/s) (mean = `r toString(format(round(mean(dat$pred_speed), digits = 2), nsmall = 2))`, sd = `r toString(format(round(sd(dat$pred_speed), digits = 2), nsmall = 2))`). For the prey, we averaged the travel speed of the four individuals within a match to obtain the average speed of the group, also measured in meters per second (mean = `r toString(format(round(mean(dat$prey_avg_speed, na.rm = T), digits = 2), nsmall = 2))`, sd = mean = `r toString(format(round(sd(dat$prey_avg_speed, na.rm = T), digits = 2), nsmall = 2))`). Hunting success was defined as the number of prey consumed during the match (min = `r toString(format(min(dat$hunting_success)))`, max = `r toString(format(max(dat$hunting_success)))`). Lastly, the predator's cumulative experience was defined as the number of matches played prior to the match being monitored. For example, the first match of a player would have a cumulative experience value of 0, while the tenth match would have a value of 9.


## Statistical analyses 

### Software and computer specifications

All our statistical analyses were executed on Cedar (https://docs.alliancecan.ca/wiki/Cedar), a computer cluster maintained by the Digital Research Alliance of Canada. The operating system for Cedar is CentOS Linux 7. The models were fitted in R (version 4.1.2) using Markov chain Monte Carlo sampling with the package "brms" version 2.16.3 [@Burkner2017], and "cmdstanr" version 0.4.0 [@Gabry.Cesnovar2021] as the backend for estimation (cmdstan installation version 2.28.2).

### Effect of experience on hunting success

We tested whether predators varied in the development of their expertise by computing 3 Bayesian generalized additive mixed models (GAMM) with thin plate regression splines estimating the relationship between hunting success (i.e. number of prey captured) and the predators' cumulative experience (i.e. number of matches played before the current match). We parametrized the models following the method by @Pedersen.etal2019. The first model was the simplest, with a common global smoothing function for all observations and random intercepts for the predator ID. In this model, we assume that individuals have the same development of expertise, with the model estimating a trend for the average individual (i.e. global smoother). For the second model, we included varying group-level smoothers for the predator ID. In this model, we assume that individuals share a similar relationship between success and experience, but that this relationship can vary (e.g. individual 1 has a steeper curve than individual 2). This enabled us to test whether predators differed in the development of their expertise. In the third model, we kept the group-level smoothers for the predators, but removed the global smoother. This allows each individual to have a unique relationship between success and experience without penalization by the global smoother. Thus, this model assumes that predators do not share a common relationship between success and experience. For all three models, we controlled for the match duration.

Because a maximum of four prey can be captured in the game, and to control for overdispersion, we computed the three models using a modified version of the beta-binomial distribution implemented in "brms" (for an overview, see https://paul-buerkner.github.io/brms/articles/brms_customfamilies.html). Thus, hunting success was estimated as the probability of capturing the four prey ($p_i$), drawn from a Beta distribution ($p_i \sim Beta(\mu_i, \phi) = Beta(\alpha = \mu\phi, \beta = (1 - \mu)\phi)$) with mean ($\mu \in [0,1]$) and shape ($\phi > 0$) parameters. We employed a logit link function to estimate $\mu_i$ where $\mu_i = \frac{exp(\eta_i)}{exp(\eta_i) + 1}$ and $\eta_i$ is the linear predictor, while the shape parameter ($\phi$) was estimated with an identity link for all models.

We employed the default number of basis functions (K) in "brms" for the models to estimate the relationship between hunting success and experience. We assumed that the random intercepts for the predator ID ($id$) followed a Gaussian distribution with estimated variance ($id \sim N(0,\ I\ \sigma^2_{id})$). We parametrized all models to run 4 MCMC chains with 1000 posterior samples for each parameter. To do so, we ran 2500 iterations for the first model with a thinning set to 8, and 1500 iterations with a thinning set to 4 for the second and third models. The first 500 iterations were used as warmups. We provide a description on how we specified the priors for each model in the supporting information. After fitting the 3 models, we proceeded to select the one with the best predictive accuracy using approximate leave-one-out cross-validation with Pareto-smoothed importance sampling [@Vehtari.etal2017].

```{r}
#\[
#\begin{align}
#logit (P_{i}) &= (\beta_{0} + id_{0,i}) \\
#&\text{ } + \text{ } \beta_{1} \textit{match duration}_{i} \\
#&\text{ } + \text{ } f(\textit{cumulative xp}_{i}) \\
#\end{align}
#\tag{1}
#\]
```

### Foraging behavior and success, prey behavior, and their relationships, at each level of experience

We proceeded to test whether foraging behavior changes with experience, and compare the success of generalists vs specialists, using a multivariate double hierarchical generalized linear model (MDHGLM) [@leeDoubleHierarchicalGeneralized2006;@cleasbyQuantifyingPredictabilityBehaviour2015;@westneatBiologyHiddenResidual2014;@Mitchell.etal2016a;@ODea.etal2022]. We categorized the predators by their experience using the predicted values from the GAMM (see Figure S1 in the supporting information). We assigned the status of "novice" to any predator player that had a cumulative experience below 100 matches. For example, a predator player that played 500 matches in total would be labelled as a novice in its first 100 matches. Following this logic, we labelled predators as "intermediate" hunters when they had a cumulative experience between 100 and 299 and matches. For the third and last group, we defined predators as "advanced" hunters when they had a cumulative experience equal or above 300, with a maximum of 499 matches.

For each level of experience (i.e. novice, intermediate, advanced), we estimated the mean speed of individual predators, and an heterogeneous structure of the residuals such that we could estimate their intra individual variance (IIV) in speed (i.e. specialization). We followed the same structure for the preys' speed to estimate among individual differences in the mean and variance in speed of the prey encountered by predators. For hunting success, we only modeled the mean part of the equation to estimate among individual differences in mean hunting success. For all variables, we controlled for the duration of the match standardized in mean and unit variance. The model has the following form, with each equation repeated three times (i.e. one for each level of experience) :

$$
\begin{align}
speed_{pred} &= \text{ } X_{m}\ b_m + M\ env_{m} + N\ av_{m} + Z\ id_{m} + e \\
log(\sigma^2_{e,\ pred}) &= X_{d} + Z\ id_{d}
\end{align}
$${#eq:eqn1}

$$
\begin{align}
speed_{prey} &= \text{ } X_{m}\ b_m + M\ env_{m} + N\ av_{m} + Z\ id_{m} + e \\
log(\sigma^2_{e,\ prey}) &= X_{d} + Z\ id_{d}
\end{align}
$${#eq:eqn2}

$$
\begin{align}
success_{pred} &= \text{ } X_{m}\ b_m + Z\ id_{m} + e
\end{align}
$${#eq:eqn3}

where $env \sim N(0,\ I\ \sigma^2_{env})$, $av \sim N(0,\ I\ \sigma^2_{av})$, and $id \sim N(0,\ I\ \sigma^2_{id})$. $b$ is the vector of fixed effects with its incidence matrix $X$. $env$, $av$, and $id$ are the vectors of random environment, random avatar, and random individual identity effects associated with their incidence matrices $M$, $N$, and $Z$. The variance parameters $\sigma^2_{env}$, $\sigma^2_{av}$, and $\sigma^2_{id}$, correspond to the among environment, among avatar, and among individual variances, respectively. $I$ is the identity matrix, with $I,\ \sigma^2$ indicating that the random effects are independently and identically distributed. The $m$ and $d$ subscripts indicate that an estimate is from the mean or dispersion part of the model, respectively. The first two equations were parametrized with a Gaussian distribution family, while the third equation was parametrized with a beta-binomial distribution family. We parametrized the model to run 4 MCMC chains with 1000 posterior samples for each parameter. To do so, we ran 2500 iterations with a thinning set to 8, with the first 500 iterations used as warmups. We explain how we specified the priors for the MDHGLM in the supporting information.

We estimated the correlation between the individual random effect on the mean and on the dispersion within each trait (e.g. $cor(\sigma^2_{id_{m}\ pred}\ \sigma^2_{id_{d}\ pred})$) and among each trait (e.g. $cor(\sigma^2_{id_{m}\ pred}\ \sigma^2_{id_{d}\ prey})$) within a level of experience. We also evaluated these correlations among the different levels of experience (e.g. $cor(\sigma^2_{id_{m}\ pred\ novice}\ \sigma^2_{id_{d}\ pred\ intermediate})$). The latter "character-state" approach [@Via.Lande1985;@viaAdaptivePhenotypicPlasticity1995], enables us to investigate whether predators express similar behaviors across each developmental stage. The correlations were estimated using a multivariate Gaussian distribution.

Lastly we calculated the coefficient of variation in the mean (termed $CV_I$) and dispersion (termed $CV_p$) part of the predator's speed for each stage of experience, allowing us to report standardized effect sizes of individual variance for comparison across traits and studies [@cleasbyQuantifyingPredictabilityBehaviour2015;@Holtmann.etal2017;@Dingemanse.etal2022]. This also allowed us to evaluate whether predators displayed increasing/decreasing differences in specialization at each stage of experience.


\newpage
# RESULTS {.unnumbered}


## Effect of experience on hunting success

Contrary to our predictions, individual predators did not differ in the development of their expertise, as the best model was the one with a global smoother with varying intercepts only (Table S1 in the supporting information). The model detected only a weak relationship between hunting success and experience (i.e. the cumulative amount of matches played), such that players did not substantially optimize their success with increasing experience as we expected (Table 1 and Figure S1 in the supporting information). However, predators did differ in their average hunting success across the study period (Figure S1). *peut être coder un autre modèle où je contrôle pour les proies afin de voir si les différences de succès disparaissent*

```{r table1, ft.align = "left"}

tab1 <- readRDS(here::here("outputs", "05_outputs_tables", "05_table2.rds"))

set_caption(
  tab1,
  caption = "Posterior mean values, standard errors, and 95% credible intervals for the GAMM with a common global smoother. The values are presented on the logit scale.",
  style = "Table Caption"
)

```




## Effect of experience on the development of behavioral specialization




```{r fig1, out.width = "100%", fig.cap = "**Figure 1.** Coefficient of variation for the predator's speed and for the speed of the prey encountered at each level of experience. (A) Coefficient of variation for the among individual differences in average behavior. (B) Coefficient fo variation for the among individual differences in intra individual variance (i.e. specialization)."}

knitr::include_graphics(here::here("outputs", "05_outputs_figures", "05_figure1.png"))

```

blablabla figure 2

```{r fig2, out.width = "100%", fig.cap = "**Figure 2.** Distribution of the intra individual behavioral variation (i.e. specialization) of predators when they were (A) novices and (B) advanced. The red band displays the 95% CI of the intercept for the intra individual variance in predator speed."}

knitr::include_graphics(here::here("outputs", "05_outputs_figures", "05_figure2.png"))

```


## Relationship between behavioral specialization and prey variability




```{r fig3, out.width = "100%", fig.cap = "**Figure 3.** Full correlation matrix of the MDHGLM relating the mean and IIV speed of the predators, the mean and IIV in speed of the prey they encountered, and mean hunting success. Starting from the upper part of the plot are displayed the five parameters for novice predators (gray), the five for intermediate predators (yellow), and the five for advanced predators (blue). Larger dark blue circles indicate stronger positive correlations, while larger dark red circles indicate stronger negative correlations. The black squares indicate correlations between different experience levels."}

knitr::include_graphics(here::here("outputs", "05_outputs_figures", "05_figure3.png"))

```


## Hunting success of behavioral specialists vs generalists

*relationship between IIV of prey and success fades with experience*


```{r fig4, out.width = "100%", fig.cap = "**Figure 4.** Title (A) and (B) Novices. (C) and (D) Advanced."}

knitr::include_graphics(here::here("outputs", "05_outputs_figures", "05_figure4.png"))

```

\newpage
# LITTERATURE CITED {.unnumbered}

<div id="refs"></div>

